<!DOCTYPE html>
<html>
<style>
  /* Style the body to center the form container horizontally */
  body {
    @import url('https://fonts.googleapis.com/css2?family=Eagle+Lake&display=swap');
    display: flex;
    /* justify-content: center; */
    align-items: flex-start;
    margin: 0;  /* Remove default margin */
    width: 100vw;
    height: 100vh;
    overflow-x: hidden;
    font-family: 'Eagle Lake', serif;
    font-size: 10pt;  /* Default font for the body */
  }

  /* Container for the form elements, centered horizontally */
  .form-container {
    display: flex;
    flex-direction: column;
    justify-content: center;
    width: 100%;
    max-width: 550px;  /* Adjust based on your preferred max form width */
    padding: 20px;
    box-sizing: border-box;
    /* border: 1px solid #ccc; /* 
    border-radius: 8px;
  }

  /* Style each label and input pair */
  .form-field {
    display: flex;
    flex-direction: column;
    align-items: flex-start;  /* Align labels and inputs to the left */
    margin-bottom: 15px;  /* Space between fields */
    width: 100%;
  }

  /* Style for labels */
  .form-field label {
    font-family: 'Eagle Lake', serif;
    color: #6b856a;
    font-size: 12pt;
    margin-bottom: 5px;
  }

  .form-title label {
    font-family: 'Eagle Lake', serif;
    color: #546b48;
    font-size: 13pt;
    margin-top: 40px;
    margin-bottom: 5px;
  }

  .confirmation-message {
    display: flex;
    flex-direction: column;
    align-items: flex-start;  /* Align labels and inputs to the left */
    margin-bottom: 15px;  /* Space between fields */
    width: 100%;
  }
  
  .checkbox-label {
      display: flex;
      align-items: center;  /* Align checkbox and text */
      gap: 8px;  /* Space between checkbox and label */
      cursor: pointer;
  }

  /* Style for labels */
  .confirmation-message label {
    font-family: 'Eagle Lake', serif;
    font-size: 10pt;
    margin-bottom: 5px;
  }

  /* Style for inputs, textareas, and buttons */
  .form-field input:not([type="radio"]),
  .form-field textarea,
  .form-field button {
    font-family: 'Eagle Lake', serif;
    font-size: 10pt;
    width: 100%; /* Instead of 80% */
    max-width: 100%;
    padding: 10px;
    margin-top: 5px; /* Slight margin for the input */
    border: 1px solid #ccc;
    border-radius: 4px;
  }

  /* Style for the button */
  .form-field button {
    background-color: #6b856a;
    color: white;
    border: none;
    cursor: pointer;
    font-size: 14px;
    margin-top: 15px;
    width: 100%;
  }

  .form-field button:hover {
    background-color: #456b48;
  }

  /* Adjust for datetime-local inputs to look consistent */
  .form-field input[type="datetime-local"] {
    width: 100%;
  }

  /* Radio buttons specific styling
  .form-field input[type="radio"] {
    width: auto;
    margin: 0 8px 0 0;
    vertical-align: middle;
  }
  
  /* Style for each radio option line */
  /* .form-field input[type="radio"] + br {
    display: block;
    content: "";
    margin-top: 8px;
  }
   */
  /* First radio option spacing */
  /* .form-field label + input[type="radio"] {
    margin-top: 8px;
  } */ */


    /* Radio options styling */
  .form-field .radio-option {
    display: flex;
    flex-direction: row;
    align-items: center;
    margin-top: 8px;
  }

  .form-field .radio-option input[type="radio"] {
    margin: 0 8px 0 0;
  }

  .form-field .radio-option label {
    margin: 0;
    font-size: 10pt;
    color: initial;
  }
  .hidden {
    display: none;
  }
  @media (max-width: 768px) {
    .hidden {
        display: none !important;
    }
  }

</style>

<body>

  <body>

  <div class="form-container">
    <!-- Step 1: Phone number input -->
    <div class="form-field">
      <label for="phone">Numéro de téléphone :</label>
      <input type="tel" id="phone" required>
      <button onclick="checkPhone()">Valider</button>
    </div>
    
    <!-- Step 2: Other fields (hidden until phone check) -->
    <div id="details" style="display:none;">
      <div class="form-field">
        <label for="name">Nom/Prénom :</label>
        <input type="text" id="name">
      </div>

      <div class="form-title">
        <label>Logistique</label>
      </div>

      <div class="form-field">
        <label for="allergies">Restrictions alimentaires :</label>
        <textarea id="allergies" rows="5" cols="50" placeholder="Allergies ou régime alimentaire particulier"></textarea>
      </div>

    <div class="confirmation-message">
        <label class="checkbox-label">
            <input type="checkbox" id="mat">
            J'apporterai un tapis de sol ou matelas gonflable
        </label>

      <div class="form-title">
        <label>Transport</label>
      </div>
      
      <div class="form-field">
        <label>Moyen de transport :</label>
        <div class="radio-option">
          <input type="radio" id="train" name="travel" value="train" onclick="toggleDriverInput()">
          <label for="train">Train</label>
        </div>
        <div class="radio-option">
          <input type="radio" id="car-driver" name="travel" value="car-driver" onclick="toggleDriverInput()">
          <label for="car-driver">Conducteur d'une voiture</label>
        </div>
        <div class="radio-option">
          <input type="radio" id="car" name="travel" value="car" onclick="toggleDriverInput()">
          <label for="car">Passager d'une voiture</label>
        </div>
        <div class="radio-option">
          <input type="radio" id="dunno" name="travel" value="dunno" onclick="toggleDriverInput()">
          <label for="dunno">Ne sait pas encore</label>
        </div>
      </div>

      <div id="driver-input" class="form-field hidden">
        <label for="driverName">Nom du conducteur :</label>
        <input type="text" id="driverName">
      </div>

      <div id="number-input" class="form-field hidden">
        <label for="spotsNumber">Nombre de places dans la voiture (conducteur inclus) :</label>
        <input type="number" id="spotsNumber" min="2" max="7" value="5" step="1">
      </div>

      <div id="aDT-input" class="form-field">
        <label for="arrivalDateTime">Heure prévue d'arrivée en gare :</label>
        <input type="datetime-local" id="arrivalDateTime" name="arrivalDateTime">
      </div>

      <div id="dloc-input" class="form-field hidden">
        <label for="departurePlace">Lieu de départ de la voiture :</label>
        <input type="text" id="departurePlace">
      </div>

      <div id="dDT-input" class="form-field">
        <label for="departureDateTime">Heure prévue de départ :</label>
        <input type="datetime-local" id="departureDateTime" name="departureDateTime">
      </div>

      <div id="aloc-input" class="form-field hidden">
        <label for="arrivalPlace">Lieu d'arrivée de la voiture (si différent du lieu de départ) :</label>
        <input type="text" id="arrivalPlace">
      </div>

      <div class="confirmation-message">
        <label class="checkbox-label">
            <input type="checkbox" id="payed" disabled>
            <span id="payed-status">Contribution bien reçue. Merci !</span>
        </label>
      </div>

      <div class="form-field">
        <button onclick="saveData()">Sauvegarder</button>
      </div>

      <div id="confirmation" class="confirmation-message hidden">
        <label>Informations enregistrées.</label>
    </div>
  </div>

  <script>

     function isMobile() {
      return /Mobi|Android|iPhone/i.test(navigator.userAgent);
    }

    document.addEventListener("DOMContentLoaded", function () {
      if (isMobile()) {
        document.body.innerHTML = "<h2 style='text-align:center; font-family: 'Eagle Lake', serif;'>Désolées, ce formulaire n'est pas disponible sur téléphone. Veuillez y accéder depuis un ordinateur.</h2>";
      }
    });

    function checkPhone() {
      let phone = document.getElementById('phone').value.replace(/\s+/g, ''); // Remove spaces
      if (phone.length < 8) {
        alert("Veuillez entrer un numéro de téléphone valide.");
        return;
      }

      google.script.run.withSuccessHandler(function(data) {
        document.getElementById("details").style.display = "block"; // Show input fields

        if (data) {
          document.getElementById('name').value = data.name; // Fill name
          document.getElementById('allergies').value = data.allergies; // Fill allergies

          // Select correct travel radio button
          let travelOptions = document.getElementsByName("travel");
          travelOptions.forEach(radio => {
            radio.checked = (radio.value === data.travel);
          });

          // Fill in the datetime values if they exist in the returned data
          if (data.arrivalDateTime) {
            document.getElementById('arrivalDateTime').value = data.arrivalDateTime; // The formatted date from Apps Script
          }
          if (data.departureDateTime) {
            document.getElementById('departureDateTime').value = data.departureDateTime; // Same for departure
          }

          if (data.departurePlace) {
            document.getElementById('departurePlace').value = data.departurePlace; // Same for departure
          }
          if (data.arrivalPlace) {
            document.getElementById('arrivalPlace').value = data.arrivalPlace; // Same for departure
          }
          if (data.spotsNumber) {
            document.getElementById('spotsNumber').value = data.spotsNumber; // Same for departure
          }
          if (data.driverName) {
            document.getElementById('driverName').value = data.driverName; // Same for departure
          }
          if (data.mat) {
            document.getElementById('mat').checked = data.mat; // Same for departure
          }
          if (data.payed) {
            document.getElementById('payed').checked = data.payed; // Same for departure
          }
          toggleDriverInput()
          togglePayedStatus()

        } else {
          document.getElementById('name').value = '';  
          document.getElementById('allergies').value = '';  

          // Uncheck all radio buttons
          document.getElementsByName("travel").forEach(radio => radio.checked = false);

          // Clear datetime fields
          document.getElementById('arrivalDateTime').value = '';
          document.getElementById('departureDateTime').value = '';
          document.getElementById('departurePlace').value = '';
          document.getElementById('arrivalPlace').value = '';
          document.getElementById('spotsNumber').value = '';
          document.getElementById('driverName').value = '';
        }
      }).getParticipantData(phone);
    }

    function displayConfirmationMessage() {
      const confirmationMessage = document.getElementById('confirmation');
      confirmationMessage.classList.remove('hidden');
      setTimeout(() => {
        confirmationMessage.classList.add('hidden');
      }, 3000);
    }

    function togglePayedStatus() {
      const payed = document.getElementById('payed');
      const statusSpan = document.getElementById('payed-status');

      if (payed.checked) {
          statusSpan.textContent = "Contribution bien reçue. Merci !";
      } else {
          statusSpan.textContent = "Contribution pas encore reçue";
      }
    }


    function toggleDriverInput() {
      // Get all radio buttons and the driver input div
      const carPassengerRadio = document.getElementById('car');
      const carDriverRadio = document.getElementById('car-driver');
      const trainRadio = document.getElementById('train');

      const driverInputDiv = document.getElementById('driver-input');
      const dlocInputDiv = document.getElementById('dloc-input');
      const alocInputDiv = document.getElementById('aloc-input');
      const aDTInputDiv = document.getElementById('aDT-input');
      const dDTInputDiv = document.getElementById('dDT-input');
      const numberInputDiv = document.getElementById('number-input');

      // Only show the driver input field if 'Passager d'une voiture' is selected
      if (carPassengerRadio.checked) {
          driverInputDiv.classList.remove('hidden');
          aDTInputDiv.classList.add('hidden');
          dDTInputDiv.classList.add('hidden');
      } else {
          driverInputDiv.classList.add('hidden');
          aDTInputDiv.classList.remove('hidden');
          dDTInputDiv.classList.remove('hidden');
      }
      if (carDriverRadio.checked) {
          dlocInputDiv.classList.remove('hidden');
          alocInputDiv.classList.remove('hidden');
          numberInputDiv.classList.remove('hidden');
      } else {
          dlocInputDiv.classList.add('hidden');
          alocInputDiv.classList.add('hidden');
          numberInputDiv.classList.add('hidden');
      }
      const label = aDTInputDiv.querySelector("label");
      if (trainRadio.checked) {
          label.textContent = "Heure prévue d'arrivée en gare :";
      } else {
          label.textContent = "Heure prévue d'arrivée :";
      }
    }

    function saveData() {
      let phone = document.getElementById('phone').value.replace(/\s+/g, '');
      let name = document.getElementById('name').value;
      let allergies = document.getElementById('allergies').value;

      // Get selected travel option
      let selectedTravel = "";
      let travelOptions = document.getElementsByName("travel");
      travelOptions.forEach(radio => {
        if (radio.checked) {
          selectedTravel = radio.value;
        }
      });

      let arrivalDateTime = document.getElementById('arrivalDateTime').value;
      let departureDateTime = document.getElementById('departureDateTime').value;
      let departurePlace = document.getElementById('departurePlace').value;
      let arrivalPlace = document.getElementById('arrivalPlace').value;
      let spotsNumber = document.getElementById('spotsNumber').value;
      let driverName = document.getElementById('driverName').value;
      let mat_checkbox = document.getElementById('mat');
      let mat = mat_checkbox.checked;
      // Send all data to Google Apps Script
      google.script.run.saveParticipantData(phone, [name, allergies, selectedTravel, arrivalDateTime, departureDateTime, departurePlace, arrivalPlace, spotsNumber, driverName, mat]);
      displayConfirmationMessage()
    }
  </script>

</body>
</html>
